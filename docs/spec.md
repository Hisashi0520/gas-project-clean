# 月報管理システム 仕様書

**バージョン:** v1.7.0
**最終更新:** 2024年12月
**ドキュメント種別:** システム仕様書

---

## 1. システム概要

### 1.1 システム名
**月報管理システム**

### 1.2 目的
- 担当者ごとに異なるテンプレートを用いて月報を入力・提出する
- 添付ファイル（PDF、Word等）を月報に添付し、Google Driveに保存する
- 過去の月報データを閲覧・確認する
- 提出状況を一覧で把握する
- 月末に向けたリマインド通知をLINE WORKSに自動送信する

### 1.3 利用者
| 利用者 | 役割 |
|--------|------|
| 一般担当者 | 月報の入力・提出、過去月報の閲覧 |
| 管理者 | 提出状況の確認、全担当者の月報閲覧 |

※認証はログイン画面で名前とパスワード（4桁）を入力する形式。権限による機能制限は現状なし（全ユーザーが同じ機能を利用可能）。

### 1.4 技術構成

| 項目 | 技術・サービス |
|------|----------------|
| バックエンド | Google Apps Script (GAS) |
| フロントエンド | HTML + CSS + JavaScript（GASテンプレート形式） |
| データストア | Google スプレッドシート |
| ファイルストレージ | Google Drive |
| 外部連携 | LINE WORKS Bot API |
| コード管理 | clasp + GitHub |
| ランタイム | V8（GAS） |
| タイムゾーン | Asia/Tokyo |

### 1.5 認証方式
- **方式:** 簡易パスワード認証（4桁数字）
- **ユーザー選択:** ドロップダウンリストから名前を選択
- **認証データ:** 「ユーザーマスタ」シートに格納
- **セッション:** ブラウザのJavaScript変数で管理（ページをリロードするとログアウト）

### 1.6 通知・連携概要
- **LINE WORKS Bot連携:** 毎月20日にリマインド通知を自動送信
- **通知先:** 設定シートで指定したチャンネルID宛
- **認証方式:** JWT（RS256）によるサービスアカウント認証

---

## 2. バージョン履歴

### 現在のバージョン: v1.7.0

| バージョン | 変更内容 |
|------------|----------|
| v1.7.0 | 添付ファイルの複数アップロードに対応。1つの質問に複数ファイルを添付可能。添付ファイルの個別削除機能。閲覧画面で複数添付ファイルのリンク表示。 |
| v1.6.0 | 過去の月報表示機能を改善。全員選択時は指定年月の月報を表示。担当者個人選択時は年月範囲（開始〜終了）を指定して過去の月報一覧を表示。 |
| v1.5.2 | 提出状況表示の問題を修正（getSubmissionStatusSimpleを使用）。対象年月を2024年4月から現在まで（新しい月は自動追加）に変更。 |
| v1.5 | 添付フォルダ名を「社員番号_氏名」形式に変更。提出済み警告・上書き確認機能を追加。 |

---

## 3. 機能一覧

| No. | 機能名 | 説明 | 状態 |
|-----|--------|------|------|
| 1 | ログイン | 名前選択とパスワード（4桁）による認証 | 正常動作 |
| 2 | ログアウト | セッションをクリアしてログイン画面に戻る | 正常動作 |
| 3 | 月報入力 | テンプレートに基づく質問形式での月報入力 | 正常動作 |
| 4 | 下書き保存 | 入力途中の月報を下書きとして保存 | 正常動作 |
| 5 | 月報提出 | 月報を「提出済」ステータスで保存 | 正常動作 |
| 6 | 添付ファイル | PDF/Word/Excel/画像/テキストファイルを添付（複数対応） | 正常動作 |
| 7 | テキスト抽出 | 添付PDF/Wordからテキストを自動抽出 | 正常動作 |
| 8 | 過去月報閲覧 | 過去の月報データを閲覧（全員/個人、単一月/期間指定） | 正常動作 |
| 9 | 提出状況確認 | 指定年月の全員の提出状況を一覧表示 | 正常動作 |
| 10 | LINE WORKS通知 | 毎月20日に月報提出リマインドを自動送信 | 正常動作 |
| 11 | 提出済み警告 | 既に提出済みの月がある場合に警告表示 | 正常動作 |
| 12 | 上書き確認 | 提出済み月報を再提出する際に確認ダイアログ表示 | 正常動作 |

---

## 4. 画面構成

### 4.1 画面遷移図

```
┌─────────────────┐
│   ログイン画面   │
│  (loginPage)    │
└────────┬────────┘
         │ ログイン成功
         ▼
┌─────────────────┐
│   メイン画面     │
│  (mainPage)     │
└────────┬────────┘
         │
    ┌────┼────┬────────────┐
    │    │    │            │
    ▼    │    ▼            ▼
┌────────┴┐ ┌──────────┐ ┌──────────┐
│入力画面  │ │閲覧画面   │ │提出状況   │
│(inputPage│ │(viewPage) │ │(statusPage│
└─────────┘ └──────────┘ └──────────┘
```

### 4.2 各画面の要素と役割

#### 4.2.1 ログイン画面 (loginPage)

| 要素 | 種類 | 役割 |
|------|------|------|
| システムタイトル | テキスト | 「月報管理システム」の表示 |
| 名前選択 | ドロップダウン | 有効なユーザーから選択 |
| パスワード入力 | テキスト入力（4桁） | パスワード認証用 |
| ログインボタン | ボタン | 認証処理を実行 |
| エラーメッセージ | テキスト | 認証エラー時に表示 |

#### 4.2.2 メイン画面 (mainPage)

| 要素 | 種類 | 役割 |
|------|------|------|
| ヘッダー | テキスト | システム名とログインユーザー名 |
| ログアウトボタン | ボタン | ログアウト処理 |
| 対象年月選択 | ドロップダウン | 入力対象の年月を選択（2024-04〜現在） |
| 月報を入力するボタン | ボタン | 入力画面へ遷移 |
| 過去の月報を見るボタン | ボタン | 閲覧画面へ遷移 |
| 提出状況を見るボタン | ボタン | 提出状況画面へ遷移 |

#### 4.2.3 入力画面 (inputPage)

| 要素 | 種類 | 役割 |
|------|------|------|
| 戻るボタン | ボタン | メイン画面へ戻る |
| ページタイトル | テキスト | 「YYYY-MM 月報入力」形式で表示 |
| 注意書き | 注意ボックス | 「報告が無い場合は『特になし』と記入」 |
| ステータス警告 | 警告ボックス | 提出済み/下書きありの場合に表示 |
| 質問リスト | フォーム | テンプレートに基づく質問と回答欄 |
| 添付ファイル選択 | ファイル入力 | 複数ファイル選択可能 |
| 選択ファイルリスト | リスト | 選択中ファイルの表示と削除ボタン |
| 下書き保存ボタン | ボタン | 下書きとして保存 |
| 提出するボタン | ボタン | 月報を提出 |

#### 4.2.4 閲覧画面 (viewPage)

| 要素 | 種類 | 役割 |
|------|------|------|
| 戻るボタン | ボタン | メイン画面へ戻る |
| 担当者選択 | ドロップダウン | 「全員」または特定担当者を選択 |
| 年月選択（単一） | ドロップダウン | 全員選択時に表示 |
| 年月範囲選択 | ドロップダウン×2 | 担当者個人選択時に表示（開始〜終了） |
| 月報カードリスト | カード | 該当する月報を一覧表示 |

#### 4.2.5 提出状況画面 (statusPage)

| 要素 | 種類 | 役割 |
|------|------|------|
| 戻るボタン | ボタン | メイン画面へ戻る |
| 年月選択 | ドロップダウン | 確認対象の年月を選択 |
| 提出状況サマリー | テキスト | 「提出済: X / Y 名」形式 |
| 提出状況テーブル | 表 | 名前、状況、提出日時を一覧表示 |

---

## 5. 主要仕様

### 5.1 対象年月の扱い

| 項目 | 仕様 |
|------|------|
| 開始月 | 2024年4月（固定） |
| 終了月 | 現在の月（自動的に最新月まで表示） |
| 形式 | 「YYYY-MM」形式（例: 2025-01） |
| ソート順 | 新しい月から古い月の順（降順） |

### 5.2 提出・下書き・上書きルール

#### ステータスの種類

| ステータス | 説明 |
|------------|------|
| 下書き | 保存済みだが未提出の状態 |
| 提出済 | 正式に提出された状態 |
| （データなし） | 該当年月のデータが存在しない |

#### 保存時の動作

| 操作 | 既存データ | 動作 |
|------|------------|------|
| 下書き保存 | なし | 新規作成（ステータス：下書き） |
| 下書き保存 | 下書き | 上書き保存 |
| 下書き保存 | 提出済 | 上書き保存（ステータス：下書きに変更） |
| 提出 | なし | 新規作成（ステータス：提出済） |
| 提出 | 下書き | 上書き保存（ステータス：提出済に変更） |
| 提出 | 提出済 | 確認ダイアログ後に上書き保存 |

※保存時は既存データを削除してから新規追加する方式（全件置換）

### 5.3 添付ファイルの扱い

#### 対応ファイル形式

| 拡張子 | MIMEタイプ | テキスト抽出 |
|--------|------------|--------------|
| .pdf | application/pdf | 対応（Google Docs変換） |
| .docx | application/vnd.openxmlformats-officedocument.wordprocessingml.document | 対応（Google Docs変換） |
| .xlsx | application/vnd.openxmlformats-officedocument.spreadsheetml.sheet | 非対応 |
| .txt | text/plain | 対応（直接読み込み） |
| .jpg, .jpeg | image/jpeg | 非対応 |
| .png | image/png | 非対応 |

#### 保存先フォルダ構造

```
添付ファイルフォルダ（設定で指定）
└── YYYY-MM/（年月フォルダ）
    └── 社員番号_氏名/（ユーザーフォルダ）
        ├── ファイル1.pdf
        ├── ファイル2.docx
        └── ...
```

#### 複数ファイル対応（v1.7.0〜）

| 項目 | 仕様 |
|------|------|
| 1質問あたりの添付数 | 複数可（上限なし） |
| URL保存形式 | カンマ区切り（` , `で区切り） |
| テキスト保存形式 | 改行と区切り線で連結（`\n\n---\n\n`） |
| ファイル個別削除 | 対応（アップロード前のみ） |

#### 共有設定

- 保存されたファイルは「リンクを知っている全員が閲覧可能」に設定

---

## 6. コード構成

### 6.1 ファイル一覧

| ファイル名 | 種別 | 役割 |
|------------|------|------|
| Code.js | サーバーサイド | メインのビジネスロジック、API関数 |
| Setup.js | サーバーサイド | 初期セットアップ、マスタデータ投入 |
| index.html | HTML | メインのHTMLテンプレート |
| css.html | CSS | スタイルシート定義 |
| js.html | JavaScript | クライアントサイドのロジック |
| appsscript.json | 設定 | GASプロジェクト設定（マニフェスト） |
| .clasp.json | 設定 | claspデプロイ設定 |

### 6.2 主要関数一覧

#### 6.2.1 Code.js - エントリーポイント

| 関数名 | 役割 | 引数 | 戻り値 |
|--------|------|------|--------|
| `doGet(e)` | Webアプリのエントリーポイント。HTMLを返す | e: イベントオブジェクト | HtmlOutput |
| `include(filename)` | HTMLファイルをインクルード | filename: ファイル名 | String（HTML文字列） |

#### 6.2.2 Code.js - ユーザー認証

| 関数名 | 役割 | 引数 | 戻り値 |
|--------|------|------|--------|
| `getActiveUsers()` | 有効なユーザー一覧を取得 | なし | Array[{employeeId, name}] |
| `authenticate(employeeId, password)` | ログイン認証を実行 | employeeId, password | {success, user/message} |

#### 6.2.3 Code.js - テンプレート

| 関数名 | 役割 | 引数 | 戻り値 |
|--------|------|------|--------|
| `getTemplate(templateId)` | 指定テンプレートの質問一覧を取得 | templateId | Array[{questionNo, title, description, allowAttachment}] |

#### 6.2.4 Code.js - 月報データ操作

| 関数名 | 役割 | 引数 | 戻り値 |
|--------|------|------|--------|
| `getReportData(employeeId, yearMonth)` | 既存の月報データを取得 | employeeId, yearMonth | Array[Report] |
| `getReportStatus(employeeId, yearMonth)` | 提出ステータスを取得 | employeeId, yearMonth | {hasData, status, isSubmitted} |
| `saveReport(reportData)` | 月報を保存（下書き/提出） | reportData | {success, message} |
| `getReportsForView(yearMonth, employeeId)` | 閲覧用月報データを取得（単一月） | yearMonth, employeeId | Array[Report] |
| `getReportsForViewRange(yearMonthFrom, yearMonthTo, employeeId)` | 閲覧用月報データを取得（期間指定） | yearMonthFrom, yearMonthTo, employeeId | Array[Report] |
| `getSubmissionStatus(yearMonth)` | 提出状況一覧を取得 | yearMonth | Array[{employeeId, name, status, submittedAt}] |
| `getSubmissionStatusSimple(yearMonth)` | 提出状況一覧を取得（シンプル版） | yearMonth | Array[{employeeId, name, status, submittedAt}] |
| `getAvailableMonths()` | 選択可能な年月リストを取得 | なし | Array[String]（YYYY-MM形式） |

#### 6.2.5 Code.js - 添付ファイル

| 関数名 | 役割 | 引数 | 戻り値 |
|--------|------|------|--------|
| `saveAttachment(fileData, fileName, yearMonth, employeeId, userName)` | 添付ファイルをDriveに保存 | Base64データ, ファイル名, 年月, 社員ID, 氏名 | {success, fileUrl, extractedText} |
| `extractTextFromFile(file, extension)` | ファイルからテキストを抽出 | Fileオブジェクト, 拡張子 | String |

#### 6.2.6 Code.js - LINE WORKS通知

| 関数名 | 役割 | 引数 | 戻り値 |
|--------|------|------|--------|
| `sendReminder()` | リマインド通知を送信 | なし | Boolean |
| `getAccessToken()` | LINE WORKSアクセストークンを取得 | なし | String |
| `createJWT(header, payload, privateKey)` | JWTを生成 | header, payload, privateKey | String |
| `createReminderTrigger()` | リマインドトリガーを設定 | なし | void |

#### 6.2.7 Code.js - ヘルパー関数

| 関数名 | 役割 | 引数 | 戻り値 |
|--------|------|------|--------|
| `normalizeYearMonth(value)` | 年月を標準文字列形式に変換 | Date or String | String（YYYY-MM形式） |
| `base64UrlEncode(str)` | Base64 URL Safe エンコード | String | String |
| `signWithRSA(data, privateKey)` | RSA署名を生成 | data, privateKey | String |

#### 6.2.8 Setup.js - セットアップ

| 関数名 | 役割 | 引数 | 戻り値 |
|--------|------|------|--------|
| `initialSetup()` | 初期セットアップを実行 | なし | void |
| `createSheets(ss)` | 必要なシートを作成 | Spreadsheet | void |
| `setupUserMaster(ss)` | ユーザーマスタに初期データを投入 | Spreadsheet | void |
| `setupTemplateMaster(ss)` | テンプレートマスタに初期データを投入 | Spreadsheet | void |
| `setupSettings(ss)` | 設定シートに初期データを投入 | Spreadsheet | void |
| `testSendReminder()` | リマインド通知のテスト送信 | なし | void |

---

## 7. データ構成

### 7.1 スプレッドシート構成

| シート名 | 役割 |
|----------|------|
| ユーザーマスタ | ログインユーザーの管理 |
| テンプレートマスタ | 担当者ごとの質問テンプレート管理 |
| 月報データ | 提出された月報データの保存 |
| 設定 | システム設定値の管理 |

### 7.2 各シートの列定義

#### 7.2.1 ユーザーマスタ

| 列 | 列名 | データ型 | 説明 | 例 |
|----|------|----------|------|-----|
| A | 社員番号 | 文字列 | ユニークな識別子 | 001 |
| B | 氏名 | 文字列 | ユーザーの表示名 | 高屋 |
| C | パスワード | 文字列 | 4桁の数字 | 1234 |
| D | テンプレートID | 文字列 | 使用するテンプレート | T001 |
| E | 有効フラグ | 真偽値 | TRUE=有効、FALSE=無効 | TRUE |

#### 7.2.2 テンプレートマスタ

| 列 | 列名 | データ型 | 説明 | 例 |
|----|------|----------|------|-----|
| A | テンプレートID | 文字列 | テンプレートの識別子 | T001 |
| B | テンプレート名 | 文字列 | テンプレートの表示名 | 高屋用 |
| C | 質問番号 | 数値 | 質問の表示順序 | 1 |
| D | 質問タイトル | 文字列 | 質問の見出し | ①毎月シフト調整 |
| E | 質問説明 | 文字列 | 質問の詳細説明（改行可） | ・予期せぬ事態に... |
| F | 添付許可 | 真偽値 | TRUE=添付可、FALSE=不可 | TRUE |

#### 7.2.3 月報データ

| 列 | 列名 | データ型 | 説明 | 例 |
|----|------|----------|------|-----|
| A | データID | 数値 | ユニークなデータ識別子 | 1 |
| B | 対象年月 | 文字列 | YYYY-MM形式 | 2025-01 |
| C | 社員番号 | 文字列 | ユーザーの社員番号 | 001 |
| D | 氏名 | 文字列 | ユーザーの表示名 | 高屋 |
| E | 質問番号 | 数値 | 回答した質問の番号 | 1 |
| F | 質問タイトル | 文字列 | 質問の見出し | ①毎月シフト調整 |
| G | 回答 | 文字列 | ユーザーの回答内容 | 特になし |
| H | 添付ファイルURL | 文字列 | DriveファイルのURL（複数時はカンマ区切り） | https://drive... |
| I | 添付ファイルテキスト | 文字列 | 抽出されたテキスト | （抽出内容） |
| J | ステータス | 文字列 | 下書き / 提出済 | 提出済 |
| K | 更新日時 | 日時 | 最終更新日時 | 2025/01/15 10:30:00 |
| L | 提出日時 | 日時 | 提出した日時（下書きは空） | 2025/01/15 10:30:00 |

#### 7.2.4 設定

| 列 | 列名 | データ型 | 説明 | 例 |
|----|------|----------|------|-----|
| A | 設定項目 | 文字列 | 設定の名称 | 通知先チャンネルID |
| B | 設定値 | 文字列 | 設定の値 | 12345678 |

##### 設定項目一覧

| 設定項目 | 説明 | 例 |
|----------|------|-----|
| リマインド日 | 月次リマインド通知の送信日 | 20 |
| 通知先チャンネルID | LINE WORKSのチャンネルID | 12345678 |
| 添付ファイル保存フォルダID | Google DriveのフォルダID | 1OjeQQB2Zg... |

---

## 8. 外部連携

### 8.1 LINE WORKS通知の仕様

#### 8.1.1 認証方式

| 項目 | 値 |
|------|-----|
| 認証方式 | JWT Bearer Grant（サービスアカウント認証） |
| JWTアルゴリズム | RS256 |
| スコープ | bot |
| トークンエンドポイント | https://auth.worksmobile.com/oauth2/v2.0/token |

#### 8.1.2 Bot API

| 項目 | 値 |
|------|-----|
| メッセージ送信API | https://www.worksapis.com/v1.0/bots/{botId}/channels/{channelId}/messages |
| メソッド | POST |
| メッセージ形式 | text |

#### 8.1.3 実行タイミング

| トリガー | タイミング | 処理 |
|----------|------------|------|
| 時間ベーストリガー | 毎月20日 午前9時 | sendReminder()を実行 |

#### 8.1.4 メッセージ内容

```
📝 【月報提出のお願い】

{月}月分の月報提出期限は月末です。
以下のURLから入力してください。

▼月報入力URL
{WebアプリURL}
```

### 8.2 Google Drive API

#### 8.2.1 使用API

| API | 用途 |
|-----|------|
| Drive API v3 | ファイルのコピー（PDF→Docs変換用） |
| DriveApp | フォルダ作成、ファイル保存、共有設定 |
| DocumentApp | 変換後のテキスト抽出 |

#### 8.2.2 必要な権限（Advanced Services）

```json
{
  "enabledAdvancedServices": [
    {
      "userSymbol": "Drive",
      "version": "v3",
      "serviceId": "drive"
    }
  ]
}
```

---

## 9. 初期セットアップ手順

### 9.1 事前準備

1. Googleアカウントを用意する
2. LINE WORKS管理者権限を持つアカウントを用意する（通知機能を使用する場合）

### 9.2 スプレッドシートの作成

1. Googleドライブで新しいスプレッドシートを作成する
2. 「拡張機能」→「Apps Script」をクリックしてスクリプトエディタを開く

### 9.3 コードのデプロイ

1. スクリプトエディタで新しいファイルを作成：
   - Code.gs（Code.jsの内容を貼り付け）
   - Setup.gs（Setup.jsの内容を貼り付け）
   - index.html
   - css.html
   - js.html

2. appsscript.jsonを編集：
   - 「プロジェクトの設定」→「「appsscript.json」マニフェスト ファイルをエディタで表示する」にチェック
   - appsscript.jsonの内容を貼り付け

### 9.4 初期データの投入

1. スクリプトエディタで「Setup.gs」を開く
2. 関数の選択で `initialSetup` を選択
3. 「実行」ボタンをクリック
4. 初回実行時は認証を許可する

### 9.5 設定の調整

1. スプレッドシートに戻る
2. 「設定」シートを開く
3. 以下の項目を実際の値に変更：
   - 「通知先チャンネルID」→ LINE WORKSの実際のチャンネルID

4. 「ユーザーマスタ」シートを開く
5. 以下を実際の情報に変更：
   - 社員番号
   - 氏名
   - パスワード（4桁の数字）
   - テンプレートID

### 9.6 添付ファイルフォルダの設定

1. Googleドライブで添付ファイル保存用フォルダを作成
2. フォルダのURLからIDを取得（`https://drive.google.com/drive/folders/XXXXX` のXXXXX部分）
3. Code.jsの `CONFIG.ATTACHMENT_FOLDER_ID` を更新

### 9.7 Webアプリとしてデプロイ

1. スクリプトエディタで「デプロイ」→「新しいデプロイ」をクリック
2. 「種類の選択」で「ウェブアプリ」を選択
3. 以下の設定を行う：
   - 説明：任意（例：月報管理システム v1.7.0）
   - 次のユーザーとして実行：**自分**
   - アクセスできるユーザー：**全員**
4. 「デプロイ」をクリック
5. 表示されるWebアプリURLをコピーして共有

### 9.8 LINE WORKS Bot設定（オプション）

1. LINE WORKS Developer Consoleでアプリを作成
2. サービスアカウントを作成
3. Bot IDを取得
4. 秘密鍵（Private Key）を生成
5. Code.jsのCONFIG内の認証情報を更新：
   - CLIENT_ID
   - CLIENT_SECRET
   - SERVICE_ACCOUNT
   - PRIVATE_KEY
   - BOT_ID

---

## 10. トラブルシューティング

### 10.1 ログインできない

| 原因 | 解決手順 |
|------|----------|
| パスワードが間違っている | 「ユーザーマスタ」シートでパスワードを確認。数字4桁であることを確認。 |
| ユーザーが無効になっている | 「ユーザーマスタ」シートの「有効フラグ」がTRUEになっていることを確認 |
| ユーザーが登録されていない | 「ユーザーマスタ」シートに該当ユーザーが存在するか確認 |

### 10.2 月報が保存できない

| 原因 | 解決手順 |
|------|----------|
| スクリプトの実行権限がない | Webアプリを再デプロイ。「次のユーザーとして実行」を「自分」に設定。 |
| スプレッドシートへのアクセス権限がない | スプレッドシートの共有設定を確認 |
| シート名が変更されている | CONFIG内のシート名（SHEET_USERS, SHEET_TEMPLATES, SHEET_DATA, SHEET_SETTINGS）と実際のシート名が一致しているか確認 |

### 10.3 添付ファイルがアップロードできない

| 原因 | 解決手順 |
|------|----------|
| 添付フォルダIDが間違っている | CONFIG.ATTACHMENT_FOLDER_IDが正しいか確認。フォルダが存在し、スクリプト実行者がアクセス権を持っているか確認。 |
| ファイルサイズが大きすぎる | GASの制限（最大50MB）を超えていないか確認 |
| Drive APIが有効になっていない | appsscript.jsonでDrive APIが有効になっているか確認。「サービス」から「Drive API」を追加。 |

### 10.4 テキスト抽出が失敗する

| 原因 | 解決手順 |
|------|----------|
| ファイル形式が対応していない | PDF、DOCX、TXTのみテキスト抽出に対応。他の形式は「（テキスト抽出失敗）」と表示される。 |
| PDFが画像のみ | スキャンされたPDF（画像のみ）はテキスト抽出不可。OCR処理は未実装。 |

### 10.5 LINE WORKS通知が届かない

| 原因 | 解決手順 |
|------|----------|
| チャンネルIDが間違っている | 「設定」シートの「通知先チャンネルID」を確認 |
| 認証情報が無効 | CLIENT_ID、CLIENT_SECRET、PRIVATE_KEYが正しいか確認 |
| Botがチャンネルに追加されていない | LINE WORKSでBotを対象チャンネルに追加 |
| トリガーが設定されていない | スクリプトエディタの「トリガー」でsendReminderのトリガーが存在するか確認。なければ`createReminderTrigger()`を実行。 |

### 10.6 提出状況が正しく表示されない

| 原因 | 解決手順 |
|------|----------|
| 年月形式の不一致 | 「月報データ」シートの「対象年月」列がYYYY-MM形式（文字列）になっているか確認。日付型になっている場合は文字列に変換。 |
| ステータスの表記揺れ | 「ステータス」列が「提出済」（半角・全角に注意）になっているか確認 |

### 10.7 デバッグ方法

1. スクリプトエディタで「実行」→「実行ログを表示」
2. デバッグ用関数を使用：
   - `debugSubmissionStatus()` - 提出状況のデバッグ
   - `debugSubmissionDetail()` - 詳細なデータ確認
   - `testGetSubmissionStatus()` - 提出状況取得のテスト
   - `testSendReminder()` - LINE WORKS通知のテスト

---

## 付録

### A. 用語集

| 用語 | 説明 |
|------|------|
| GAS | Google Apps Script。Googleサービスを自動化・拡張するためのスクリプト言語・実行環境。 |
| スプレッドシート | Googleが提供するオンライン表計算ソフト。Excelに相当。 |
| clasp | Command Line Apps Script Projects。GASをローカルで開発するためのCLIツール。 |
| JWT | JSON Web Token。認証情報を安全に送受信するための規格。 |
| テンプレート | 担当者ごとに定義された質問項目のセット。 |
| 年月 | YYYY-MM形式で表される対象月。例：2025-01 |
| 下書き | 保存済みだが未提出の月報の状態。 |
| 提出済 | 正式に提出された月報の状態。 |
| トリガー | 指定した条件で自動的にスクリプトを実行する仕組み。 |

### B. 設定値一覧（CONFIG）

| 設定名 | 説明 | デフォルト値 |
|--------|------|--------------|
| CLIENT_ID | LINE WORKS API Client ID | （要設定） |
| CLIENT_SECRET | LINE WORKS API Client Secret | （要設定） |
| SERVICE_ACCOUNT | LINE WORKS サービスアカウント | （要設定） |
| PRIVATE_KEY | LINE WORKS 秘密鍵 | （要設定） |
| BOT_ID | LINE WORKS Bot ID | （要設定） |
| ATTACHMENT_FOLDER_ID | 添付ファイル保存先フォルダID | （要設定） |
| SHEET_USERS | ユーザーマスタシート名 | ユーザーマスタ |
| SHEET_TEMPLATES | テンプレートマスタシート名 | テンプレートマスタ |
| SHEET_DATA | 月報データシート名 | 月報データ |
| SHEET_SETTINGS | 設定シート名 | 設定 |

---

*本仕様書は実装コードに基づいて作成されています。*
